<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>{{ title }}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" />
	<link rel="stylesheet" type="text/css" href="/themes/whiskeypodcast/css/custom.css" />
	<link rel="shortcut icon" href="themes/whiskeypodcast/favicon.ico?v=1.1"> 
</head>
<body>
	<div class="menu">
	  <section>
  	  <img src="/images/itunes_image.jpg" />
    	<h1>{{ title }}</h1>
    	<h2>{{ subtitle }}</h2>
    	<ul>
    	  <li class="eplink"><a href="#episodes"><i class="fa fa-headphones"></i> Episodes</a></li>
    	  <li class="itunes"><a href="itpc://whiskeypodcast.com/feed.xml"><i class="fa fa-music"></i> Add to iTunes</a></li>
        <li class="rss"><a href="/feed.xml"><i class="fa fa-rss"></i> RSS Feed</a></li>
        <li class="email"><a href="mailto:whiskeypodcast@gmail.com"><i class="fa fa-envelope"></i> Email us</a></li>
    	</ul>
  	</section>
	</div>
	
	<div class="episodes">
	  <h2><i class="fa fa-bars" id="main-menu"></i> Episodes</h2>
  	<ul id="ep-list">
  	</ul>
	</div>
	
	<div class="ep_info">
	  <h2><i class="fa fa-angle-left"> <span>Back</span></i> Information</h2>
	  <article>
  	  <h1></h1>
  	  <p></p>
  	  <div class="linkbar">
    	  <a href="#play"><i class="fa fa-headphones"></i>Listen Now</a><a href="#download"><i class="fa fa-download"></i>Download</a>
  	  </div>
	  </article>
	</div>
	
	<div id="jp_container">
					<div id="jquery_jplayer"></div>
					<p class="timer">
						<span class="track-name">&nbsp;</span>
						
					</p>
					
					<ul class="music-controls">
							<li><a class="jp-play" href="#"><i class="fa fa-play"></i></a></li>
							<li><a class="jp-pause" href="#"><i class="fa fa-pause"></i></a></li>
							<!--<li><a class="jp-stop btn btn-primary" href="#"><i class="fa fa-stop"></i></a></li>-->
					</ul>

					<div class="jp-progress">
						<div class="jp-seek-bar">
							<div class="jp-play-bar"></div>
						</div>
					</div>
					<div class="timedur">
  					<span class="jp-current-time"></span> | <span class="jp-duration"></span>
					</div>
					<!-- <div class="btn-holder">
					
						<div class="volume-holder">
							<a class="jp-mute" href="#"><i class="fa fa-volume-off"></i></a>
							<a class="jp-unmute" href="#"><i class="fa fa-volume-down"></i></a>
							
							<div class="jp-volume-bar">
								<div class="jp-volume-bar-value"></div>
							</div>
			
							<a class="jp-volume-max" href="#"><i class="fa fa-volume-up"></i></a>
						</div> -->
					</div>
</body>
<script type="text/javascript" src="/components/player/jquery.jplayer.min.js"></script>
<script>
$(document).ready(function() {
  // First get the hash
  var ephash = window.location.hash.replace("/","").replace("#","").replace("/","");
  console.log(ephash);
  
  // Local copy of jQuery selectors, for performance.
	var	my_jPlayer = $("#jquery_jplayer"),
		my_trackName = $("#jp_container .track-name"),
		my_playState = $("#jp_container .play-state");

	// Some options
	var	opt_play_first = false, // If true, will attempt to auto-play the default track on page loads. No effect on mobile devices, like iOS.
		opt_auto_play = true, // If true, when a track is selected, it will auto-play.
		opt_text_playing = "", // Text when playing
		opt_text_selected = ""; // Text when not playing

	// A flag to capture the first track
	var first_track = true;

	// Initialize the play state text
	my_playState.text(opt_text_selected);

	// Instance jPlayer
	my_jPlayer.jPlayer({
		ready: function () {
			// Load up the first track. Play it based on if a hash is set or not. 
      if(ephash.length > 0) {
        epid = $("ul#ep-list li[data-epid="+ephash+"]").attr("id");
      } else {
        epid = $("ul#ep-list li:first-child").attr("id");
      }
      my_trackName.text(items[epid].title);
  		my_jPlayer.jPlayer("setMedia", {
  			mp3:items[epid].audio
  		});

		},
		play: function(event) {
			my_playState.text(opt_text_playing);
		},
		pause: function(event) {
			my_playState.text(opt_text_selected);
		},
		ended: function(event) {
			my_playState.text(opt_text_selected);
		},
		swfPath: "/components/player",
		cssSelectorAncestor: "#jp_container",
		supplied: "mp3",
		wmode: "window"
	});
	
  var items = [];
  // Handler for .ready() called.
  $.getJSON( "/feed.json", function( data ) {      
    // Create the big data object for all episodes.
    $.each( data['item'], function( key, val ) {
      
      var playitem = {};
      playitem["title"] = val['title'];
      playitem["audio"] = val['enclosure'];
      playitem["image"] = val['image'];
      playitem["description"] = val["description"];
      
      items.push(playitem);
    });
  }).done(function() {
    // Create the list.
    $.each(items, function(key, val){
      //console.log(val['image']);
      var tempimg = val['image'];
      
      // make the ID from the MP3
      eplongid = val['audio'].split("/");
      eplongid = eplongid[eplongid.length - 1];
      eplongid = eplongid.split(".");
      eplongid = eplongid[0];
      
      $("ul#ep-list").append( "<li id='" + key + "' data-epid=\""+eplongid+"\" class=\"track\"><img src=\""+tempimg+"\" /><p>" + val['title'] + "</p></li>" );
    });
    
    // Load the first episode. Feels like a hack. Works. So whatever.
    // Check for a hash to select the correct episode
    if(ephash.length > 0) {
      $("ul#ep-list li[data-epid="+ephash+"]").click();
  		
    } else if($(window).width() > 600) {
      // Check for a hash to select the correct episode
      $("ul#ep-list li:first-child").click();
    }
  }); 
  
  $("#ep-list").delegate( "li", "click", function() {
    $("#ep-list .active").removeClass("active");
    $(this).addClass("active");
    
    var epid = $(this).attr("id");
    
    window.location.hash = "/"+$(this).data("epid")+"/";
    
    if($(window).width() < 600) {
      $(".ep_info").animate({"left":0},300);
    }
    
    $(".ep_info h1").text(items[epid].title);
    $(".ep_info p").text(items[epid].description);
    $(".ep_info a[href=#download]").attr("href",items[epid].audio);	
    $(".ep_info a[href=#play]").click(function(e){
      e.preventDefault();
  		// update the jPlayer to play the file, fool.
      my_trackName.text(items[epid].title);
  		my_jPlayer.jPlayer("setMedia", {
  			mp3:items[epid].audio
  		}).jPlayer("play");
    });
  });
  $("#main-menu").click(function() {
    $(".menu").animate({"left":0}, 300);
  });
  $(".ep_info h2 i").click(function() {
    $(".ep_info").animate({"left": "100%"},300);
  })
  $(".eplink").click(function(e) {
    e.preventDefault();
    if($(window).width() < 600) {
      $(".menu").animate({"left":"-100%"}, 300);
    }
  });
});
   
</script>
</html>